<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hi-Hive Reborn: Reverse Engineering the Application (Part 1) | Blog</title>
<meta name=keywords content="react-native,android,javascript,reverse-engineering"><meta name=description content="During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.
After using the application for a few years, I noticed that it was too bloated with unnecessary features, it&rsquo;s not very responsive, and important items are buried in unending levels of menus.
Thus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks."><meta name=author content="Yii Kuo Chong"><link rel=canonical href=yiikuochong.com/hi-hive-reborn-reverse-engineering-part-1/><link crossorigin=anonymous href=/yiikuochong.com/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=yiikuochong.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=yiikuochong.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=yiikuochong.com/favicon-32x32.png><link rel=apple-touch-icon href=yiikuochong.com/apple-touch-icon.png><link rel=mask-icon href=yiikuochong.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DKYY4HJSRB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DKYY4HJSRB",{anonymize_ip:!1})}</script><meta property="og:title" content="Hi-Hive Reborn: Reverse Engineering the Application (Part 1)"><meta property="og:description" content="During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.
After using the application for a few years, I noticed that it was too bloated with unnecessary features, it&rsquo;s not very responsive, and important items are buried in unending levels of menus.
Thus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks."><meta property="og:type" content="article"><meta property="og:url" content="yiikuochong.com/hi-hive-reborn-reverse-engineering-part-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-09T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-09T00:00:00+00:00"><meta property="og:site_name" content="CodeOwl Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hi-Hive Reborn: Reverse Engineering the Application (Part 1)"><meta name=twitter:description content="During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.
After using the application for a few years, I noticed that it was too bloated with unnecessary features, it&rsquo;s not very responsive, and important items are buried in unending levels of menus.
Thus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"yiikuochong.com/posts/"},{"@type":"ListItem","position":3,"name":"Hi-Hive Reborn: Reverse Engineering the Application (Part 1)","item":"yiikuochong.com/hi-hive-reborn-reverse-engineering-part-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hi-Hive Reborn: Reverse Engineering the Application (Part 1)","name":"Hi-Hive Reborn: Reverse Engineering the Application (Part 1)","description":"During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.\nAfter using the application for a few years, I noticed that it was too bloated with unnecessary features, it\u0026rsquo;s not very responsive, and important items are buried in unending levels of menus.\nThus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks.","keywords":["react-native","android","javascript","reverse-engineering"],"articleBody":"During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.\nAfter using the application for a few years, I noticed that it was too bloated with unnecessary features, it’s not very responsive, and important items are buried in unending levels of menus.\nThus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks.\nTo do so, I first needed to figure how the API works.\nPreliminary Analysis Through regular usage, I suspected that it uses some kind of web/mobile hybrid framework.\nSome symptoms I’ve noticed are:\nSlow and slightly off user interface - There will be slight delays when tapping on elements, animation is slow, and low frame rates at times. Lack of uniformity in the components - A lot of the components seems custom made. There are a mix of native elements with custom ones. Existence of web-view pages - Some of the functions are loaded through webview. All in all it feels like using a website. My gut feelings tell me that it’s a web/mobile hybrid framework. Most likely using React Native.\nDissecting the Application The only method to really confirm this is by cracking it open and have a look at the internals. Here, we will be using version 2.3.1 of the applicaiton downloaded from ApkPure.\nUnpacking the .apk I unpacked the .apk using jadx and immediately there are telltale signs of React Native.\nFor example, this image below shows configuration for a react native push notification library.\nWhich upon further investigation, it appears that this library was used: https://github.com/zo0r/react-native-push-notification, which is a React Native library for push notifications.\nChecking for presence of index.android.bundle Furthermore, there is also presence of index.android.bundle as seen below.\nThe index.android.bundle contains compiled and bundled JavaScript code for the application. Only React Native bundles this.\nDisassembling Hermes Bytecode Immediately, I tried to open the bundle using a text editor but it showed an error.\nAfter a google search, I found out that Hermes VM is the default compilation target for more recent versions of React Native. Which is confirmed by the file command:\nFortunately, P1 Security released a tool to disassemble, and decompile Hermes bytecodes.\nUsing the tool (hermes-dec), I disassembled the Hermes bytecode into somewhat readable pseudo-javascript.\nHowever this is still super unreadable due to it being converted from javascript -\u003e obfuscated javascript -\u003e hermes bytecode -\u003e decompiled WASM -\u003e disassembled javascript.\nThis meant that it’s a “readable” version of the WASM instructions, not how the original code is structured.\nIdeally, we want it to be javascript -\u003e obfuscated javascript which should be more readable and actually represent the original code.\nBack to the square one and cracking an older version The hermes-dec project README states that React Native only started targetting the Hermes VM by default after React Native v0.70.\nI thought, what if the targetting of Hermes VM isn’t actually on purpose? So I grabbed version 1.0.2 of the application and cracked it open.\nNOTE: Hi-Hive Community v1.0.2 was released before React Native v0.70.\nAs predicted! The index.android.bundle file is only obfuscated Javascript, not Hermes bytecode!\nThis is a more readable version of the index.android.bundle file compared to the one from version 2.3.1, not by much but it’s still better than nothing.\nWhat this means is that we now have a base from which to reverse engineer the API used by the application.\nReversing and mapping the API After a bit of searching, I found the following parts. It seems to be an object containing all the API domain, and paths.\nNOTE: Through comparing v1.0.2 and v2.3.1, I found out that API_DOMAIN is not pointing to www.silverlakemobility.com anymore, it is now pointing to www.hi-hive.com.\nTo implement the application, we only need to figure out some of the endpoints.\nThe API endpoints relevant to us are:\nEndpoints for authentication Endpoints for listing courses \u0026 classes Endpoints for scanning QR codes With these, we can start mapping the needed endpoints and figure out what to pass to it.\nAuthentication Figuring out the Authentication Method List courses \u0026 classes Scanning QR Roadblock to putting together a 3rd party library Other Methods Conclusion ","wordCount":"704","inLanguage":"en","datePublished":"2024-09-09T00:00:00Z","dateModified":"2024-09-09T00:00:00Z","author":{"@type":"Person","name":"Yii Kuo Chong"},"mainEntityOfPage":{"@type":"WebPage","@id":"yiikuochong.com/hi-hive-reborn-reverse-engineering-part-1/"},"publisher":{"@type":"Organization","name":"Blog","logo":{"@type":"ImageObject","url":"yiikuochong.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=yiikuochong.com accesskey=h title="Blog (Alt + H)">Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=yiikuochong.com/yiikuochong.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=yiikuochong.com>Home</a>&nbsp;»&nbsp;<a href=yiikuochong.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Hi-Hive Reborn: Reverse Engineering the Application (Part 1)</h1><div class=post-meta><span title='2024-09-09 00:00:00 +0000 UTC'>September 9, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Yii Kuo Chong</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#preliminary-analysis aria-label="Preliminary Analysis">Preliminary Analysis</a></li><li><a href=#dissecting-the-application aria-label="Dissecting the Application">Dissecting the Application</a><ul><li><a href=#unpacking-the-apk aria-label="Unpacking the .apk">Unpacking the .apk</a></li><li><a href=#checking-for-presence-of-indexandroidbundle aria-label="Checking for presence of index.android.bundle">Checking for presence of index.android.bundle</a></li><li><a href=#disassembling-hermes-bytecode aria-label="Disassembling Hermes Bytecode">Disassembling Hermes Bytecode</a></li><li><a href=#back-to-the-square-one-and-cracking-an-older-version aria-label="Back to the square one and cracking an older version">Back to the square one and cracking an older version</a></li></ul></li><li><a href=#reversing-and-mapping-the-api aria-label="Reversing and mapping the API">Reversing and mapping the API</a><ul><li><a href=#authentication aria-label=Authentication>Authentication</a><ul><li><a href=#figuring-out-the-authentication-method aria-label="Figuring out the Authentication Method">Figuring out the Authentication Method</a></li></ul></li><li><a href=#list-courses--classes aria-label="List courses & classes">List courses & classes</a></li><li><a href=#scanning-qr aria-label="Scanning QR">Scanning QR</a></li></ul></li><li><a href=#roadblock-to-putting-together-a-3rd-party-library aria-label="Roadblock to putting together a 3rd party library">Roadblock to putting together a 3rd party library</a></li><li><a href=#other-methods aria-label="Other Methods">Other Methods</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>During COVID-19, my university debuted an attendance tracking called Hi-Hive Community. A lecturer would present a QR code, and the students will scan it to take attendance.</p><p>After using the application for a few years, I noticed that it was too bloated with unnecessary features, it&rsquo;s not very responsive, and important items are buried in unending levels of menus.</p><p>Thus, I have the idea of rebuilding the application using Kotlin, Jetpack Compose, and more modern UI frameworks.</p><p>To do so, I first needed to figure how the API works.</p><h1 id=preliminary-analysis>Preliminary Analysis<a hidden class=anchor aria-hidden=true href=#preliminary-analysis>#</a></h1><p>Through regular usage, I suspected that it uses some kind of web/mobile hybrid framework.</p><p>Some symptoms I&rsquo;ve noticed are:</p><ol><li><strong>Slow and slightly off user interface</strong> - There will be slight delays when tapping on elements, animation is slow, and low frame rates at times.</li><li><strong>Lack of uniformity in the components</strong> - A lot of the components seems custom made. There are a mix of native elements with custom ones.</li><li><strong>Existence of web-view pages</strong> - Some of the functions are loaded through webview.</li></ol><p>All in all it <em>feels</em> like using a website. My gut feelings tell me that it&rsquo;s a web/mobile hybrid framework. Most likely using React Native.</p><h1 id=dissecting-the-application>Dissecting the Application<a hidden class=anchor aria-hidden=true href=#dissecting-the-application>#</a></h1><p>The only method to really confirm this is by cracking it open and have a look at the internals. Here, we will be using version <code>2.3.1</code> of the applicaiton downloaded from <a href=https://apkpure.com/hi-hive-community/com.slc.hihive.community>ApkPure</a>.</p><h2 id=unpacking-the-apk>Unpacking the <code>.apk</code><a hidden class=anchor aria-hidden=true href=#unpacking-the-apk>#</a></h2><p>I unpacked the .apk using <code>jadx</code> and immediately there are telltale signs of React Native.</p><p>For example, this image below shows configuration for a react native push notification library.</p><p><img loading=lazy src=./images/reactnative_proof.png alt="Image of configuration for a React Native library" title="Image of configuration for a React Native library"></p><p>Which upon further investigation, it appears that this library was used: <a href=https://github.com/zo0r/react-native-push-notification>https://github.com/zo0r/react-native-push-notification</a>, which is a React Native library for push notifications.</p><h2 id=checking-for-presence-of-indexandroidbundle>Checking for presence of <code>index.android.bundle</code><a hidden class=anchor aria-hidden=true href=#checking-for-presence-of-indexandroidbundle>#</a></h2><p>Furthermore, there is also presence of <code>index.android.bundle</code> as seen below.</p><p><img loading=lazy src=./images/reactnative_bundle_proof.png alt="Image of index.android.bundle in file structure" title="Image of index.android.bundle in file structure"></p><p>The <code>index.android.bundle</code> contains compiled and bundled JavaScript code for the application. Only React Native bundles this.</p><h2 id=disassembling-hermes-bytecode>Disassembling Hermes Bytecode<a hidden class=anchor aria-hidden=true href=#disassembling-hermes-bytecode>#</a></h2><p>Immediately, I tried to open the bundle using a text editor but it showed an error.</p><p><img loading=lazy src=./images/cannot_open_bundle.png alt="Image of cannot open bundle" title="Image of cannot open bundle"></p><p>After a google search, I found out that Hermes VM is the default compilation target for more recent versions of React Native. Which is confirmed by the <code>file</code> command:</p><p><img loading=lazy src=./images/file_command_result.png alt="Image of file tool showing result" title="Image of file tool showing result"></p><p>Fortunately, <a href=https://www.p1sec.com/blog/releasing-hermes-dec-an-open-source-disassembler-and-decompiler-for-the-react-native-hermes-bytecode>P1 Security</a> released a tool to disassemble, and decompile Hermes bytecodes.</p><p>Using the tool (<a href=https://github.com/P1sec/hermes-dec/>hermes-dec</a>), I disassembled the Hermes bytecode into somewhat readable pseudo-javascript.</p><p><img loading=lazy src=./images/not_so_readable_pseudocode.png alt="Image of not so readable pseudocode" title="Image of not so readable pseudocode"></p><p>However this is still super unreadable due to it being converted from <code>javascript</code> -> <code>obfuscated javascript</code> -> <code>hermes bytecode</code> -> <code>decompiled WASM</code> -> <code>disassembled javascript</code>.</p><p>This meant that it&rsquo;s a &ldquo;readable&rdquo; version of the WASM instructions, not how the original code is structured.</p><p>Ideally, we want it to be <code>javascript</code> -> <code>obfuscated javascript</code> which should be more readable and actually represent the original code.</p><h2 id=back-to-the-square-one-and-cracking-an-older-version>Back to the square one and cracking an older version<a hidden class=anchor aria-hidden=true href=#back-to-the-square-one-and-cracking-an-older-version>#</a></h2><p>The <code>hermes-dec</code> project README states that React Native only started targetting the Hermes VM by default after React Native v0.70.</p><p>I thought, <em>what if the targetting of Hermes VM isn&rsquo;t actually on purpose?</em> So I grabbed version <code>1.0.2</code> of the application and cracked it open.</p><blockquote><p>NOTE: Hi-Hive Community v1.0.2 was released before React Native v0.70.</p></blockquote><p>As predicted! The <code>index.android.bundle</code> file is only obfuscated Javascript, not Hermes bytecode!</p><p><img loading=lazy src=./images/more_readable_bundle.png alt="Image of more readable bundle" title="Image of more readable bundle"></p><p>This is a more readable version of the <code>index.android.bundle</code> file compared to the one from version <code>2.3.1</code>, not by much but it&rsquo;s still better than nothing.</p><p>What this means is that we now have a base from which to reverse engineer the API used by the application.</p><h1 id=reversing-and-mapping-the-api>Reversing and mapping the API<a hidden class=anchor aria-hidden=true href=#reversing-and-mapping-the-api>#</a></h1><p>After a bit of searching, I found the following parts. It seems to be an object containing all the API domain, and paths.</p><p><img loading=lazy src=./images/api_constants.png alt="Image of API constants" title="Image of API constants"></p><blockquote><p>NOTE: Through comparing v1.0.2 and v2.3.1, I found out that <code>API_DOMAIN</code> is not pointing to <code>www.silverlakemobility.com</code> anymore, it is now pointing to <code>www.hi-hive.com</code>.</p></blockquote><p>To implement the application, we only need to figure out some of the endpoints.</p><p>The API endpoints relevant to us are:</p><ul><li>Endpoints for authentication</li><li>Endpoints for listing courses & classes</li><li>Endpoints for scanning QR codes</li></ul><p>With these, we can start mapping the needed endpoints and figure out what to pass to it.</p><h2 id=authentication>Authentication<a hidden class=anchor aria-hidden=true href=#authentication>#</a></h2><h3 id=figuring-out-the-authentication-method>Figuring out the Authentication Method<a hidden class=anchor aria-hidden=true href=#figuring-out-the-authentication-method>#</a></h3><h2 id=list-courses--classes>List courses & classes<a hidden class=anchor aria-hidden=true href=#list-courses--classes>#</a></h2><h2 id=scanning-qr>Scanning QR<a hidden class=anchor aria-hidden=true href=#scanning-qr>#</a></h2><h1 id=roadblock-to-putting-together-a-3rd-party-library>Roadblock to putting together a 3rd party library<a hidden class=anchor aria-hidden=true href=#roadblock-to-putting-together-a-3rd-party-library>#</a></h1><p><img loading=lazy src=./images/firebase_restriction.png alt="Image of firebase restriction" title="Image of firebase restriction"></p><h1 id=other-methods>Other Methods<a hidden class=anchor aria-hidden=true href=#other-methods>#</a></h1><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1></div><footer class=post-footer><ul class=post-tags><li><a href=yiikuochong.com/tags/react-native/>react-native</a></li><li><a href=yiikuochong.com/tags/android/>android</a></li><li><a href=yiikuochong.com/tags/javascript/>javascript</a></li><li><a href=yiikuochong.com/tags/reverse-engineering/>reverse-engineering</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=yiikuochong.com>Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>